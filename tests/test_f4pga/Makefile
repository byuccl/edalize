#Auto generated by Edalize

export ANALYSIS_FILE=test_f4pga_0.analysis
export FASM_FILE=top_module.fasm
export BITSTREAM_FILE=test_f4pga_0.bit
export DEVICE_TYPE=artix7
export DEVICE_NAME=xc7a50t_test
export DEVICE_NAME_MODIFIED=$(shell echo ${DEVICE_NAME} | sed -n 's/_/-/p')
export PART=xc7a35tcpg236-1
export TOP=top_module
export INPUT_XDC_FILES=top.xdc
export PYTHON=python3
export USE_ROI="FALSE"
export TECHMAP_PATH=${F4PGA_ENV_SHARE}/techmaps/xc7_vpr/techmap
export DATABASE_DIR=$(shell prjxray-config)
export PART_JSON=${DATABASE_DIR}/${DEVICE_TYPE}/${PART}/part.json
export OUT_FASM_EXTRA=test_f4pga_0_fasm_extra.fasm
export OUT_SDC=test_f4pga_0.sdc
export OUT_SYNTH_V=test_f4pga_0_synth.v
export OUT_JSON=test_f4pga_0.json
export PYTHON3=$(shell which python3)
export UTILS_PATH=${F4PGA_ENV_SHARE}/scripts
export SYNTH_JSON=test_f4pga_0_io.json
export OUT_EBLIF=test_f4pga_0.eblif
export ARCH_DIR=${F4PGA_ENV_SHARE}/arch/${DEVICE_NAME}
export RR_GRAPH=${ARCH_DIR}/rr_graph_${DEVICE_NAME}.rr_graph.real.bin
export LOOKAHEAD=${ARCH_DIR}/rr_graph_${DEVICE_NAME}.lookahead.bin
export PLACE_DELAY=${ARCH_DIR}/rr_graph_${DEVICE_NAME}.place_delay.bin
export ARCH_DEF=${ARCH_DIR}/arch.timing.xml
export DBROOT=${DATABASE_DIR}/${DEVICE_TYPE}
export IOGEN=${F4PGA_ENV_SHARE}/scripts/prjxray_create_ioplace.py
export CONSTR_GEN=${F4PGA_ENV_SHARE}/scripts/prjxray_create_place_constraints.py
export CONSTR_FILE=constraints.place
export PINMAP_FILE=${ARCH_DIR}/${PART}/pinmap.csv
export VPR_GRID_MAP=${ARCH_DIR}/vpr_grid_map.csv
export IOPLACE_FILE=test_f4pga_0.ioplace
export OUT_NOISY_WARNINGS=noisy_warnings-${DEVICE_NAME}_fasm.log
export VPR_OPTIONS=--disp on --max_router_iterations 500 --routing_failure_predictor off --router_high_fanout_threshold -1 --constant_net_method route --route_chan_width 500 --router_heap bucket --clock_modeling route --place_delta_delay_matrix_calculation_method dijkstra --place_delay_model delta --router_lookahead extended_map --check_route quick --strict_checks off --allow_dangling_combinational_nodes on --disable_errors check_unbuffered_edges:check_route --congested_routing_iteration_threshold 0.8 --incremental_reroute_delay_ripup off --base_cost_type delay_normalized_length_bounded --bb_factor 10 --acc_fac 0.7 --astar_fac 1.8 --initial_pres_fac 2.828 --pres_fac_mult 1.2 --check_rr_graph off --suppress_warnings ${OUT_NOISY_WARNINGS},sum_pin_class:check_unbuffered_edges:load_rr_indexed_data_T_values:check_rr_node:trans_per_R:check_route:set_rr_graph_tool_comment:calculate_average_switch


all: post_build

pre_build: 

${OUT_JSON}: ${F4PGA_ENV_SHARE}/scripts/xc7/synth.tcl | pre_build
	$(EDALIZE_LAUNCHER) yosys -l yosys.log -p 'tcl ${F4PGA_ENV_SHARE}/scripts/xc7/synth.tcl' 

${SYNTH_JSON}: ${F4PGA_ENV_SHARE}/scripts/split_inouts.py ${OUT_JSON}
	$(EDALIZE_LAUNCHER) ${PYTHON} ${F4PGA_ENV_SHARE}/scripts/split_inouts.py -i ${OUT_JSON} -o ${SYNTH_JSON}

test_f4pga_0.eblif: ${SYNTH_JSON} ${F4PGA_ENV_SHARE}/scripts/xc7/conv.tcl
	$(EDALIZE_LAUNCHER) yosys -l yosys.log -p 'read_json ${SYNTH_JSON}; tcl ${F4PGA_ENV_SHARE}/scripts/xc7/conv.tcl'

test_f4pga_0.net: test_f4pga_0.eblif
	$(EDALIZE_LAUNCHER) vpr ${F4PGA_ENV_SHARE}/arch/${DEVICE_NAME}/arch.timing.xml test_f4pga_0.eblif --pack ${VPR_OPTIONS} --read_rr_graph ${RR_GRAPH} --read_router_lookahead ${LOOKAHEAD} --read_placement_delay_lookup ${PLACE_DELAY}

${IOPLACE_FILE}: test_f4pga_0.net
	$(EDALIZE_LAUNCHER) ${PYTHON} ${IOGEN} --blif test_f4pga_0.eblif --map ${PINMAP_FILE} --net test_f4pga_0.net > ${IOPLACE_FILE}

${CONSTR_FILE}: ${IOPLACE_FILE}
	$(EDALIZE_LAUNCHER) ${PYTHON} ${CONSTR_GEN} --net test_f4pga_0.net --arch ${ARCH_DEF} --blif test_f4pga_0.eblif --vpr_grid_map ${VPR_GRID_MAP} --input ${IOPLACE_FILE} --db_root ${DATABASE_DIR} --part ${PART} > ${CONSTR_FILE}

test_f4pga_0.place: ${CONSTR_FILE}
	$(EDALIZE_LAUNCHER) vpr ${F4PGA_ENV_SHARE}/arch/${DEVICE_NAME}/arch.timing.xml test_f4pga_0.eblif --fix_clusters ${CONSTR_FILE} --place ${VPR_OPTIONS} --read_rr_graph ${RR_GRAPH} --read_router_lookahead ${LOOKAHEAD} --read_placement_delay_lookup ${PLACE_DELAY}

test_f4pga_0.route: test_f4pga_0.place
	$(EDALIZE_LAUNCHER) vpr ${F4PGA_ENV_SHARE}/arch/${DEVICE_NAME}/arch.timing.xml test_f4pga_0.eblif --route ${VPR_OPTIONS} --read_rr_graph ${RR_GRAPH} --read_router_lookahead ${LOOKAHEAD} --read_placement_delay_lookup ${PLACE_DELAY}

test_f4pga_0.analysis: test_f4pga_0.route
	$(EDALIZE_LAUNCHER) vpr ${F4PGA_ENV_SHARE}/arch/${DEVICE_NAME}/arch.timing.xml test_f4pga_0.eblif --analysis ${VPR_OPTIONS} --read_rr_graph ${RR_GRAPH} --read_router_lookahead ${LOOKAHEAD} --read_placement_delay_lookup ${PLACE_DELAY}

${FASM_FILE}: ${ANALYSIS_FILE}
	$(EDALIZE_LAUNCHER) genfasm ${ARCH_DEF} ${OUT_EBLIF} --device ${DEVICE_NAME_MODIFIED} ${VPR_OPTIONS} --read_rr_graph ${RR_GRAPH}

${BITSTREAM_FILE}: ${FASM_FILE}
	$(EDALIZE_LAUNCHER) xcfasm --db-root ${DBROOT} --part ${PART} --part_file ${DBROOT}/${PART}/part.yaml --sparse --emit_pudc_b_pullup --fn_in ${FASM_FILE} --bit_out ${BITSTREAM_FILE} ${FRM2BIT}

post_build: ${BITSTREAM_FILE}

pre_run: 

run: pre_run

post_run: run
